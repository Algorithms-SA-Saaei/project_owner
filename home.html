<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="stylesheet" href="./style.css">
  <link rel="stylesheet" href="./splash.css">

</head>
<body>

<!-- ğŸ”¹ Ø´Ø§Ø´Ø© Ø§Ù„Ù€ Splash -->
<div class="splash" id="splash">
  <div class="overlay"></div>
  <div class="splash-content text-center">
    <img src="./logo.png" alt="logo" class="splash-logo" />
    <h2 class="splash-text mt-3">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ø³Ø§Ø¹ÙŠ</h2>
  </div>
</div>

<!-- ğŸ”¹ Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ -->
<button id="logoutBtn">
  <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
</button>

<div class="container stat-container" style="display:none;" id="mainContent">
  <img alt="" id="logo" src="./logo.png"/>
  <p id="projectName" class="fw-bold text-center mt-3">--</p>

  <div class="stat-card">
    <div class="stat-value-box">
      <div class="icon-box" title="Ø§ØªØµØ§Ù„ ÙˆØ±Ø³Ø§Ù„Ø©">
        <i class="fas fa-comment-dots"></i>
      </div>
      <span class="stat-value" id="stat-value1">--
        <small class="text-white-50">Ø§ØªØµØ§Ù„ ÙˆØ±Ø³Ø§Ù„Ø©</small>
      </span>
    </div>
    <div class="stat-label" style="text-align: left;">Ø¹Ø¯Ø¯ Ø§Ù„ØªÙˆØ§ØµÙ„</div>
  </div>

  <div class="stat-card">
    <div class="stat-label"  style="text-align: right;">Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª</div>
    <div class="stat-value-box">
      <span class="stat-value" id="stat-value2">--
        <small class="text-white-50">Ø¹Ù…ÙŠÙ„</small>
      </span>
      <div class="icon-box" title="Ø¹Ù…ÙŠÙ„">
        <i class="fas fa-users"></i>
      </div>
    </div>
  </div>

  <div class="stat-card">
    <div class="stat-value-box">
      <div class="icon-box" title="Ù…Ø­Ø¬ÙˆØ²">
        <i class="fas fa-building"></i>
      </div>
      <span class="stat-value" id="stat-value3">--
        <small class="text-white-50">Ø­Ø¬Ø²</small>
      </span>
    </div>
    <div class="stat-label"  style="text-align: left;">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø¬ÙˆØ²</div>
  </div>
  <div class="stat-card">
    <div class="stat-label" style="text-align: right;">Ø§Ø¬Ù…Ø§Ù„Ù‰ Ø§Ù„Ù…Ø­Ø¬ÙˆØ²  </div>
    <div class="stat-value-box">
      <span class="stat-value" id="stat-value4">--
        <small class="text-white-50">Ø±ÙŠÙ€Ù€Ù€Ø§Ù„</small>
      </span>
      <div class="icon-box" title=" Ø§Ø¬Ù…Ø§Ù„Ù‰ Ø§Ù„Ù…Ø­Ø¬ÙˆØ²">
        <i class="fas fa-dollar"></i>
      </div>
    </div>
  </div>
  <div class="stat-card">
    <div class="stat-value-box">
      <div class="icon-box" title="Ø´Ù‚Ù‚ ØªÙ… Ø¨ÙŠØ¹Ù‡Ø§ ">
        <i class="fas fa-building"></i>
      </div>
      <span class="stat-value" id="stat-value5">--
        <small class="text-white-50">Ø´Ù‚Ø©</small>
      </span>
    </div>
    <div class="stat-label" style="text-align: left;">  Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨Ø§Ø¹</div>
  </div>
  <div class="stat-card">
    <div class="stat-label" style="text-align: right;">Ø§Ø¬Ù…Ø§Ù„Ù‰ Ø§Ù„Ù…Ø¨Ø§Ø¹  </div>
    <div class="stat-value-box">
      <span class="stat-value" id="stat-value6">--
        <small class="text-white-50">Ø±ÙŠÙ€Ù€Ù€Ø§Ù„</small>
      </span>
      <div class="icon-box" title=" Ø§Ø¬Ù…Ø§Ù„Ù‰ Ø§Ù„Ù…Ø¨Ø§Ø¹">
        <i class="fas fa-dollar"></i>
      </div>
    </div>
  </div>
  <div class="stat-card">
    <div class="stat-value-box">
      <div class="icon-box" title="Ø´Ù‚Ù‚ ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… ">
        <i class="fas fa-building"></i>
      </div>
      <span class="stat-value" id="stat-value7">--
        <small class="text-white-50">Ø´Ù‚Ø©</small>
      </span>
    </div>
    <div class="stat-label" style="text-align: left;"> ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</div>
  </div>
  <div class="stat-card">
    <div class="stat-label" style="text-align: right;">Ø§Ø¬Ù…Ø§Ù„Ù‰ Ø§Ù„ØªØ³Ù„ÙŠÙ…  </div>
    <div class="stat-value-box">
      <span class="stat-value" id="stat-value8">--
        <small class="text-white-50">Ø±ÙŠÙ€Ù€Ù€Ø§Ù„</small>
      </span>
      <div class="icon-box" title=" Ø§Ø¬Ù…Ø§Ù„Ù‰ Ø§Ù„ØªØ³Ù„ÙŠÙ…">
        <i class="fas fa-dollar"></i>
      </div>
    </div>
  </div>
  <div class="stat-card">
    <div class="stat-value-box">
      <div class="icon-box" title="Ø´Ù‚Ù‚ ØªÙ… Ø§ÙØ±Ø§ØºÙ‡Ø§ ">
        <i class="fas fa-building"></i>
      </div>
      <span class="stat-value" id="stat-value9">--
        <small class="text-white-50">Ø´Ù‚Ø©</small>
      </span>
    </div>
    <div class="stat-label" style="text-align: left;"> ØªÙ… Ø§Ù„Ø§ÙØ±Ø§Øº</div>
  </div>
  <div class="stat-card">
    <div class="stat-label" style="text-align: right;">Ø§Ø¬Ù…Ø§Ù„Ù‰ Ø§Ù„Ù…ÙØ±Øº  </div>
    <div class="stat-value-box">
      <span class="stat-value" id="stat-value10">--
        <small class="text-white-50">Ø±ÙŠÙ€Ù€Ù€Ø§Ù„</small>
      </span>
      <div class="icon-box" title=" Ø§Ø¬Ù…Ø§Ù„Ù‰ Ø§Ù„Ù…ÙØ±Øº">
        <i class="fas fa-dollar"></i>
      </div>
    </div>
  </div>

  <div class="stat-card last-card">
    <div class="stat-value-box">
      <div class="icon-box" title="Ù…Ø´Ø§Ù‡Ø¯Ø§Øª">
        <i class="fas fa-eye"></i>
      </div>
      <span class="stat-value" id="stat-value11">--
        <small class="text-white-50">Ù…Ø´Ø§Ù‡Ø¯Ø©</small>
      </span>
    </div>
    <div class="stat-label">Ø¹Ø¯Ø¯ Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ±ÙˆÙŠØ¬ ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
(function() {
  const token = localStorage.getItem('token');
  if (!token) {
    window.location.href = './login.html';
    return;
  }

  // ğŸ”¹ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
  document.getElementById('logoutBtn').addEventListener('click', () => {
    localStorage.removeItem('token');
    localStorage.removeItem('user');
    localStorage.removeItem('projectReport');
    window.location.href = './login.html';
  });

  const userData = JSON.parse(localStorage.getItem('user') || "{}");
  const projectId = userData.project ? userData.project : 3;

  // ğŸ”¹ Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„Ù„ÙˆØ¯Ù†Ø¬
  const splash = document.getElementById('splash');
  const mainContent = document.getElementById('mainContent');

  fetch(`https://api.saaei.co/api/v1/projects/${projectId}/ownerProjectReport/get`, {
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    }
  })
  .then(res => {
    if (!res.ok) throw new Error('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    return res.json();
  })
  .then(data => {
    renderStats(data);
  })
  .catch(err => {
    console.error('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', err);
  })
  .finally(() => {
    // ğŸ”¹ Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ù„ÙˆØ¯Ù†Ø¬ Ø¨Ø¹Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ùetch
    setTimeout(() => {
      splash.classList.add('hide');
      mainContent.style.display = 'block';
    }, 500); // ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ù„ØªØ­ÙˆÙ„ Ø§Ù„Ø³Ù„Ø³
  });

  function renderStats(data) {
    document.getElementById('stat-value1').firstChild.textContent = data.contactCount ?? 0;
    document.getElementById('stat-value2').firstChild.textContent = data.visitingsCount ?? 0;
    document.getElementById('stat-value3').firstChild.textContent = data.bookedCount ?? 0;
    document.getElementById('stat-value4').firstChild.textContent = data.bookedAmount ?? 0;
    document.getElementById('stat-value5').firstChild.textContent = data.soldCount ?? 0;
    document.getElementById('stat-value6').firstChild.textContent = data.soldAmount ?? 0;
    document.getElementById('stat-value7').firstChild.textContent = data.deliveredCount ?? 0;
    document.getElementById('stat-value8').firstChild.textContent = data.deliveredAmount ?? 0;
    document.getElementById('stat-value9').firstChild.textContent = data.completedCount ?? 0;
    document.getElementById('stat-value10').firstChild.textContent = data.completedAmount ?? 0;
    document.getElementById('stat-value11').firstChild.textContent = data.totalViews ?? 0;

    if (data.project && data.project.name) {
      document.getElementById('projectName').textContent = data.project.name;
    }
    if (data.project && data.project.img) {
      document.getElementById('logo').src = data.project.img;
    }
  }
})();
</script>

</body>
</html>
